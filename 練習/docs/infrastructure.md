# インフラ構成図

## 1. システム全体構成

```
┌─────────────────────────────────────────────────────────────────────────┐
│                            Internet                                      │
└───────────────────────────────────┬─────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                     Firebase Hosting (CDN)                               │
│                 https://mini-games-web-app.web.app                       │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                        Global CDN                                │    │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐        │    │
│  │  │  Tokyo   │  │   US     │  │  Europe  │  │   ...    │        │    │
│  │  │  Edge    │  │  Edge    │  │  Edge    │  │  Edge    │        │    │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘        │    │
│  └─────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                    Google Cloud Platform (GCP)                           │
│                    Project: mini-games-web-app                           │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                   Firebase Services                              │    │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │    │
│  │  │   Hosting    │  │  (将来拡張)   │  │  (将来拡張)   │          │    │
│  │  │  Static      │  │  Firestore   │  │    Auth      │          │    │
│  │  │  Files       │  │  Database    │  │   Service    │          │    │
│  │  └──────────────┘  └──────────────┘  └──────────────┘          │    │
│  └─────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 2. デプロイフロー

```
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│   開発環境    │     │    GitHub    │     │   Firebase   │
│  (ローカル)   │     │  Repository  │     │   Hosting    │
└──────┬───────┘     └──────┬───────┘     └──────┬───────┘
       │                    │                    │
       │  git push          │                    │
       ├───────────────────▶│                    │
       │                    │                    │
       │  firebase deploy   │                    │
       ├────────────────────┼───────────────────▶│
       │                    │                    │
       │                    │    公開完了        │
       │◀───────────────────┼────────────────────┤
       │                    │                    │
```

---

## 3. ファイル配信フロー

```
┌──────────────┐
│    User      │
│  (Browser)   │
└──────┬───────┘
       │ HTTPS Request
       │ GET https://mini-games-web-app.web.app/tetris.html
       ▼
┌──────────────┐
│  Firebase    │
│  CDN Edge    │
│  (最寄り)     │
└──────┬───────┘
       │ キャッシュ確認
       │
   ┌───┴───┐
   │Cache? │
   └───┬───┘
       │
  ┌────┴────┐
  │         │
 HIT      MISS
  │         │
  ▼         ▼
┌─────┐  ┌──────────┐
│返却 │  │  Origin  │
│     │  │  Server  │
└─────┘  └────┬─────┘
              │
              ▼
         ┌─────────┐
         │キャッシュ│
         │  更新   │
         └────┬────┘
              │
              ▼
         ┌─────────┐
         │  返却   │
         └─────────┘
```

---

## 4. リソース詳細

### 4.1 GCPプロジェクト

| 項目 | 値 |
|-----|-----|
| プロジェクト名 | Mini Games and Apps |
| プロジェクトID | mini-games-web-app |
| プロジェクト番号 | 399539881660 |
| オーナー | kosuke.omure@aozora-cg.com |
| 作成日 | 2025-12-18 |

### 4.2 Firebase Hosting

| 項目 | 値 |
|-----|-----|
| サイトURL | https://mini-games-web-app.web.app |
| 代替URL | https://mini-games-web-app.firebaseapp.com |
| SSL | 自動（Let's Encrypt） |
| CDN | Firebase Global CDN |

### 4.3 有効化されたAPI

| API名 | 用途 |
|------|------|
| Cloud Resource Manager API | プロジェクト管理 |
| Firebase Hosting API | 静的ファイルホスティング |
| Cloud APIs | 基本API |

---

## 5. セキュリティ

### 5.1 現在の設定

```
┌─────────────────────────────────────────────┐
│              Security Layer                  │
├─────────────────────────────────────────────┤
│  ✅ HTTPS強制 (SSL/TLS)                      │
│  ✅ Firebase CDN DDoS保護                    │
│  ✅ 自動証明書更新                           │
│  ✅ セキュアヘッダー（基本）                  │
└─────────────────────────────────────────────┘
```

### 5.2 推奨追加設定（将来）

- Content Security Policy (CSP)
- CORS設定
- Rate Limiting
- Firebase App Check

---

## 6. 料金

### 6.1 Firebase Hosting (Sparkプラン - 無料枠)

| リソース | 無料枠 |
|---------|--------|
| ストレージ | 10 GB |
| 転送量 | 360 MB/日 |
| カスタムドメイン | 対応 |
| SSL証明書 | 無料 |

### 6.2 現在の使用量

- ストレージ: 約100KB（3ファイル）
- 転送量: 無料枠内

---

## 7. 将来の拡張構成（案）

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        Mini Games Platform                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                  │
│  │   Firebase   │  │   Firebase   │  │   Firebase   │                  │
│  │   Hosting    │  │   Auth       │  │   Firestore  │                  │
│  │  (静的配信)   │  │  (認証)      │  │ (ランキング)  │                  │
│  └──────────────┘  └──────────────┘  └──────────────┘                  │
│         │                 │                 │                           │
│         └─────────────────┼─────────────────┘                           │
│                           │                                              │
│                           ▼                                              │
│                  ┌──────────────┐                                        │
│                  │  Cloud       │                                        │
│                  │  Functions   │                                        │
│                  │ (バックエンド) │                                        │
│                  └──────────────┘                                        │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 8. 監視・ログ

### アクセス方法

1. **Firebaseコンソール**
   - URL: https://console.firebase.google.com/project/mini-games-web-app/hosting
   - 内容: デプロイ履歴、使用量

2. **GCPコンソール**
   - URL: https://console.cloud.google.com/home/dashboard?project=mini-games-web-app
   - 内容: リソース監視、API使用量

---

## 9. 関連リンク

- [Firebase Hosting 料金](https://firebase.google.com/pricing)
- [Firebase Hosting 割り当て](https://firebase.google.com/docs/hosting/usage-quotas-pricing)
- [GCPコンソール](https://console.cloud.google.com/home/dashboard?project=mini-games-web-app)
